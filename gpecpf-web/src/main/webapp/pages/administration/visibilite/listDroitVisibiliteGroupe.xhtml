<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/templates/templateAdmin.xhtml"
                xmlns:a="http://elit.dz/ui"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core">

    <ui:define name="Title">
        #{bundleAdmin.titre_visibilite}
    </ui:define>

    <ui:define name="breadCrumb"> 
        <a:breadcrumb>
            <a:menuitem value="#{bundleAdmin.titre_visibilite}" />
            <a:menuitem value="#{bundleAdmin.titre_liste_groupe}" href="listDroitVisibiliteGroupe.xhtml" last="true"/>
        </a:breadcrumb>
    </ui:define>

    <ui:define name="MyContent">
        <h:form id="form">
            <a:row>
                <a:pagetitle value="#{bundleAdmin.titre_liste_groupe}" />
                <p:button value="#{bundleCommun.btn_nouveau}" icon="fa fa-plus " styleClass="GreenButton" 
                          title="#{bundleAdmin.titre_nouveau_groupe_visibilite}" outcome="addDroitVisibiliteGroupe" rendered="true" />
                <p:messages id="msgs" globalOnly="true" showDetail="true" closable="true"/>                
            </a:row>
            
            <a:row>
                <a:panel header=" #{bundleAdmin.titre_visibilite}" iconheader="fa fa-list-ul" id="idPanel">
                    <p:dataTable id="idListGroupesTab" var="VarGroupe" reflow="true"
                                 value="#{addGroupeVisibiliteController.listeGroupe}" widgetVar="wListGroupesTab" 
                                 emptyMessage="Liste vide" resizableColumns="true" >
                        <p:column sortBy="#{VarGroupe.libelle}" style="width: 160px;">
                            <f:facet name="header">
                                <h:outputText value="Libelle"/>
                            </f:facet>
                            <h:outputText value="#{VarGroupe.libelle}"/>
                        </p:column>
                        <p:column sortBy="#{VarGroupe.description}">
                            <f:facet name="header">
                                <h:outputText value="Description"/>
                            </f:facet>
                            <h:outputText value="#{VarGroupe.description}"/>
                        </p:column>
                        <p:column sortBy="#{VarGroupe.adminDroitVisibiliteList}" style="width: 120px;">
                            <f:facet name="header">
                                <h:outputText value="Liste des Droits"/>
                            </f:facet>
                            <h:outputText value="#{VarGroupe.adminDroitVisibiliteList.size()} droit(s)" id="idDroitGroupe" 
                                          style="border-bottom: 1px dotted;"/>
                            <p:tooltip for="idDroitGroupe" showEffect="clip" hideEffect="clip">
                                <p:dataTable value="#{addGroupeVisibiliteController.construireListeDroit(VarGroupe).entrySet().toArray()}" var="droit" >
                                    <p:column sortBy="#{droit.key}">
                                        <f:facet name="header">
                                            <h:outputText value="Droit de visibilité"/>
                                        </f:facet>
                                        <h:outputText value="#{droit.key}"/>
                                    </p:column>
                                    <p:column sortBy="#{droit.value}">
                                        <f:facet name="header">
                                            <h:outputText value="Unité"/>
                                        </f:facet>
                                        <h:outputText value="#{droit.value}"/>
                                    </p:column>
                                </p:dataTable>
                            </p:tooltip>
                        </p:column>
                        <p:column sortBy="#{VarGroupe.listMembre.size()}" style="width: 120px;">
                            <f:facet name="header">
                                <h:outputText value="Liste des Membres"/>
                            </f:facet>
                            <h:outputText value="#{VarGroupe.listMembre.size()} membre(s)" id="idMembresGroupe" 
                                          style="border-bottom: 1px dotted;"/>
                            <p:tooltip id="idM" for="idMembresGroupe" showEffect="clip" hideEffect="clip">
                                <p:dataTable value="#{VarGroupe.listMembre}" var="mbr">
                                    <p:column sortBy="#{mbr.nom}, #{mbr.prenom}">
                                        <f:facet name="header">
                                            <h:outputText value="Liste des membres"/>
                                        </f:facet>
                                        <h:outputText value="#{mbr.nom}, #{mbr.prenom}"/>
                                    </p:column>
                                </p:dataTable>
                            </p:tooltip>
                        </p:column>


                        <p:column style="width: 120px;">
                            <f:facet name="header">
                                <h:outputText value="Actions"/>
                            </f:facet>
                            <p:column headerText="#{bundleCommun.lbl_actions}" width="120">
                                <p:commandButton icon="fa fa-info" title="#{bundleCommun.lbl_visualisation_detail}" action="showDroitVisibiliteGroupe" ajax="false" rendered="true">  
                                    <f:param name="id" value="#{VarGroupe.id}" />
                                </p:commandButton>  
                                <p:commandButton icon="fa fa-pencil-square-o" title="#{bundleCommun.lbl_modification}" action="editDroitVisibiliteGroupe" ajax="false" rendered="true">
                                    <f:param name="id" value="#{VarGroupe.id}"></f:param>
                                </p:commandButton>  
                                <p:commandButton icon="fa fa-times" actionListener="#{addGroupeVisibiliteController.remove(VarGroupe)}" title="#{bundleCommun.lbl_suppression}" update=":form" rendered="true">
                                    <p:confirm header="#{bundleCommun.lbl_confirmation}" message="#{bundleCommun.msg_confirm_vs_suppr_enregistrement}" icon="ui-icon-alert" />
                                </p:commandButton>
                            </p:column>
                        </p:column>
                    </p:dataTable>
                </a:panel>
            </a:row>
        </h:form>
    </ui:define>

    <ui:define name="MyDialog">

    </ui:define>

</ui:composition>