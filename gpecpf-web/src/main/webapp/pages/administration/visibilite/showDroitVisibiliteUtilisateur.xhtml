<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/templates/templateAdmin.xhtml"
                xmlns:a="http://elit.dz/ui"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core">

    <ui:define name="Title">
        #{bundleAdmin.titre_visibilite}
    </ui:define>

    <ui:define name="breadCrumb"> 
        <a:breadcrumb>
            <a:menuitem value="#{bundleAdmin.titre_visibilite}" />
            <a:menuitem value="#{bundleAdmin.titre_liste_groupe}" href="listDroitVisibiliteGroupe.xhtml" last="true"/>
        </a:breadcrumb>
    </ui:define>

    <ui:define name="MyContent">
        <h:form id="form">
            <a:row>
                <a:pagetitle value="Utilisateur" />
                <p:button value="#{bundleCommun.btn_nouveau}" icon="fa fa-plus " styleClass="GreenButton" 
                          title="#{bundleAdmin.titre_nouveau_groupe_visibilite}" outcome="addDroitVisibiliteGroupe" rendered="true" />
                <p:messages id="msgs" globalOnly="true" showDetail="true" closable="true"/>                
            </a:row>
            <a:row>
                <a:panel id="idPanel" isPadding="true">
                    <a:label value="#{bundleAdmin.lbl_utilisateur}" span="2"/>  
                    <a:column span="9">
                        <a:row nomargin="true">
                            <a:column span="1">
                                <p:commandButton value="...." immediate="true" onclick="PF('dialogUtilisateur').show();"/>
                            </a:column>
                            <a:column span="5">
                                <p:inputText id="nom" value="#{showDroitVisibiliteUtilisateur.utilisateur.nom} #{showDroitVisibiliteUtilisateur.utilisateur.prenom}" label="nom" readonly="true"/>
                            </a:column>
                        </a:row>
                    </a:column>
                </a:panel>
            </a:row>
            <a:row>
                <a:panel header=" #{bundleAdmin.titre_liste_groupe}" iconheader="fa fa-list-ul" >
                    <p:dataTable id="tableGroupes" value="#{showDroitVisibiliteUtilisateur.utilisateur.listAdminGroupe}" var="groupe" 
                                 emptyMessage="#{bundleCommun.msg_list_vide}" paginator="true" paginatorAlwaysVisible="false" 
                                 paginatorPosition="bottom" rows="10">
                        <p:column width="35">
                            <p:rowToggler />
                        </p:column>
                        <p:column headerText="#{bundleAdmin.lbl_libelle}">
                            <h:outputText value="#{groupe.libelle}"/>
                        </p:column>
                        <p:column headerText="#{bundleAdmin.lbl_description}">
                            <h:outputText value="#{groupe.description}"/>
                        </p:column>
                    </p:dataTable>
                </a:panel>
            </a:row>
            <a:row>
                <a:panel header=" #{bundleAdmin.titre_liste_droit_visilite}" iconheader="fa fa-list-ul">
                    <p:dataTable id="idListePieceTab" var="piece" 
                                 value="#{showDroitVisibiliteUtilisateur.listeDroitVisibilite.entrySet().toArray()}"
                                 emptyMessage="Liste vide" resizableColumns="true" 
                                 style="font-family: serif;">
                        <p:column width="10%;">
                            <f:facet name="header">
                                <h:outputText value="Unités / Entités"/>
                            </f:facet>
                            <h:outputText value="#{piece.key}"/>
                        </p:column>

                        <p:column>
                            <f:facet name="header">
                                <p:dataTable value="" styleClass="hide-content-names">
                                    <p:columns value="#{showDroitVisibiliteUtilisateur.listeUnite}" 
                                               var="head" headerText="#{head.code}"/>
                                </p:dataTable>
                            </f:facet>
                            <p:dataTable value="" styleClass="hide-column-names">
                                <p:columns value="#{piece.value}" var="pc">
                                    <div align="center">
                                        <p:selectBooleanCheckbox value="#{pc.selected}" disabled="true"/>
                                    </div>
                                </p:columns>
                            </p:dataTable>
                        </p:column>
                    </p:dataTable>
                </a:panel>
            </a:row>
        </h:form>
    </ui:define>

    <ui:define name="MyDialog">
        <h:form id="formDialogs">
            <p:dialog id="dialogUtilisateurId" header="#{bundleAdmin.lien_liste_utilisateur}" widgetVar="dialogUtilisateur" 
                      width="460" position="center" modal="true" >
                <p:dataTable value="#{showDroitVisibiliteUtilisateur.listeUtilisateur}" var="utilisateur" 
                             selectionMode="single" selection="#{showDroitVisibiliteUtilisateur.utilisateur}" rowKey="#{utilisateur.id}"                                
                             emptyMessage="#{bundleCommun.msg_list_vide}" paginator="true" paginatorAlwaysVisible="false" rows="10">
                    <p:ajax event="rowSelect" update=":form" oncomplete="PF('dialogUtilisateur').hide();" listener="#{showDroitVisibiliteUtilisateur.construireListeDroit()}"/>
                    <p:column headerText="#{bundleAdmin.lbl_prenom}" filterBy="#{utilisateur.nom}">
                        <h:outputText value="#{utilisateur.nom}"/>
                    </p:column> 
                    <p:column headerText="#{bundleAdmin.lbl_nom}" filterBy="#{utilisateur.prenom}">
                        <h:outputText value="#{utilisateur.prenom}"/>
                    </p:column> 
                    <p:column headerText="#{bundleAdmin.lbl_unite_organisationnelle}" filterBy="#{utilisateur.adminUniteOrganisationnelle.code}">
                        <h:outputText value="#{utilisateur.adminUniteOrganisationnelle.code}"/>
                    </p:column>
                </p:dataTable>
            </p:dialog>
        </h:form>
    </ui:define>

</ui:composition>