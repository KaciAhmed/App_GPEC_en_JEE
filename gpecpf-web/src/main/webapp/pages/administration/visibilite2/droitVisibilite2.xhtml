<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core">

    <body>

        <ui:composition template="./../../../templates/templateAdmin.xhtml">

            <ui:define name="Title">
                Droit de visibilité
            </ui:define>

            <ui:define name="breadCrumb">
                <p:menuitem value="Droits de visibilité" outcome="droitVisibilite.xhtml" />
            </ui:define>

            <ui:define name="MyContent">
                <h:form id="F_Gen">
                    <p:panel id="idPanel">
                        <p:messages id="message_globale" showDetail="true" autoUpdate="true" closable="true" />

                        <h:panelGrid columns="3" id="panUtilisateur">
                            <p:outputLabel value="Utilisateur: " for="nomUtilisateur"/>
                            <p:column>
                                <p:inputText id="prenomUtilisateur" size="25" value="#{droitVisibiliteController.utilisateurAdt.prenom}" readonly="true"/>
                                <p:commandButton value="..." id="btUtilisateurListe" immediate="true" onclick="PF('wListUtilisateur').show()" />
                                <p:inputText id="nomUtilisateur" size="65" readonly="true" value="#{droitVisibiliteController.utilisateurAdt.nom}"/>
                            </p:column>
                            <span/>

                            <p:outputLabel value="Module: " for="module"/>
                            <p:columnGroup>
                                <p:column>
                                    <p:inputText id="module" size="25" readonly="true" 
                                                 value="#{droitVisibiliteController.module.code}"/>
                                </p:column>
                                <p:commandButton value="..." immediate="true" onclick="PF('wListModule').show()"/>
                                <p:inputText id="moduleCode" size="65" readonly="true"
                                             value="#{droitVisibiliteController.module.libelle}"/>
                            </p:columnGroup>
                            <span/>

                            <p:outputLabel value="Entité: " for="entity"/>
                            <p:columnGroup>
                                <p:column>
                                    <p:inputText id="entity" size="25" readonly="true" 
                                                 value="#{droitVisibiliteController.objetVisibilite.entity}"/>
                                </p:column>
                                <p:commandButton value="..." immediate="true" onclick="PF('wListEntity').show()"/>
                                <p:inputText id="entityCode" size="65" readonly="true"
                                             value="#{droitVisibiliteController.objetVisibilite.libelle}"/>
                            </p:columnGroup>
                            <span/>
                            <p:commandButton value="Chercher" actionListener="#{droitVisibiliteController.creerTree()}" 
                                             update="treeDroit" icon="ui-icon-search"/>
                        </h:panelGrid>

                        <h:panelGrid columns="3">
                            <h:panelGrid columns="2">    
                                <p:selectBooleanCheckbox  id="position" value="#{droitVisibiliteController.positionBool}" >
                                    <p:ajax listener="#{droitVisibiliteController.changerPosition()}" update="treeDroit"/>
                                </p:selectBooleanCheckbox> 
                                <p:outputLabel value="Position(V/H): " for="position" />
                            </h:panelGrid>
                        </h:panelGrid>
                    </p:panel>
                    <p:panel id="idPanelTree">
                        <p:tree id="treeDroit" value="#{droitVisibiliteController.hierarchieUnite}" var="node" 
                                orientation="#{droitVisibiliteController.position}" selectionMode="checkbox" 
                                propagateSelectionUp="false"  propagateSelectionDown="false" >
                            <p:ajax event="select" listener="#{droitVisibiliteController.selectUnite(node)}"/>
                            <p:ajax event="unselect" listener="#{droitVisibiliteController.unselectUnite(node)}"/>
                            <p:treeNode>
                                <h:outputText value="#{node.code}" id="infoNode"/>
                                <p:tooltip for="infoNode" showEffect="clip" hideEffect="clip">
                                    <h:outputText value="#{node.denominationFr}"/>
                                </p:tooltip>
                            </p:treeNode>
                        </p:tree>
                        <br/>
                        <p:commandButton value="Valider" style="float: left;" icon="ui-icon-check"
                                         actionListener="#{droitVisibiliteController.addDroit()}" update="idPanel, idPanelTree" />
                        <br/><br/>
                    </p:panel>
                </h:form>
            </ui:define>

            <ui:define name="mesDialog">
                <h:form id="fListUtilisateur">
                    <p:dialog header="Liste des utilisateurs" widgetVar="wListUtilisateur"
                              resizable="false" id="idListUtilisateur" modal="true">

                        <p:dataTable id="idListUtilisateurTab" var="VarUtilisateur" 
                                     value="#{droitVisibiliteController.listeUtilisateur}" 
                                     widgetVar="wListUtilisateurTab" rows="10"
                                     paginator="true" emptyMessage="Liste vide" resizableColumns="true" 
                                     style="width: 700px; font-family: serif;"
                                     paginatorTemplate="{FirstPageLink} {PreviousPageLink} 
                                     {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" 
                                     selection="#{droitVisibiliteController.utilisateurAdt}" rowKey="#{VarUtilisateur.id}">
                            <f:facet name="header">                                
                                Séléctioner un utilisateur
                            </f:facet>
                            <p:column selectionMode="single" style="width:16px; text-align:center"/>
                            <p:column filterBy="#{VarUtilisateur.adminUniteOrganisationnelle.code}" 
                                      sortBy="#{VarUtilisateur.adminUniteOrganisationnelle.code}" width="75">
                                <f:facet name="header">
                                    <h:outputText value="Structure"/>
                                </f:facet>
                                <h:outputText value="#{VarUtilisateur.adminUniteOrganisationnelle.code}"/>
                            </p:column>
                            <p:column filterBy="#{VarUtilisateur.nom}, #{VarUtilisateur.prenom}" 
                                      sortBy="#{VarUtilisateur.nom}, #{VarUtilisateur.prenom}" width="250">
                                <f:facet name="header">
                                    <h:outputText value="Nom"/>
                                </f:facet>
                                <h:outputText value="#{VarUtilisateur.nom}, #{VarUtilisateur.prenom}"/>
                            </p:column>
                        </p:dataTable>

                        <p:commandButton value="Valider" id="bdValiderChef" onclick="PF('wListUtilisateur').hide()" icon="ui-icon-check" 
                                         style="float: left;" update=":F_Gen:nomUtilisateur, :F_Gen:prenomUtilisateur"/>
                        <p:commandButton value="Non" onclick="PF('wListUtilisateur').hide();" type="button" style="float: left;"/>

                    </p:dialog>
                </h:form>

                <h:form id="fListModule">
                    <p:dialog header="Liste des modules" widgetVar="wListModule"
                              resizable="false" id="idListModule" modal="true">

                        <p:dataTable id="idListModuleTab" var="VarModule" 
                                     value="#{droitVisibiliteController.listeModule}"
                                     widgetVar="wListModuleTab" rows="10"
                                     paginator="true" emptyMessage="Liste vide" resizableColumns="true" 
                                     rowsPerPageTemplate="5, 10" style="width: 700px; font-family: serif;"
                                     paginatorTemplate="{FirstPageLink} {PreviousPageLink} 
                                     {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" 
                                     selection="#{droitVisibiliteController.module}" rowKey="#{VarModule.id}">
                            <f:facet name="header">                                
                                Séléctioner un module
                            </f:facet>
                            <p:column selectionMode="single" style="width:16px;text-align:center"/>
                            <p:column filterBy="#{VarModule.code}" sortBy="#{VarModule.code}" width="120">
                                <f:facet name="header">
                                    <h:outputText value="Code"/>
                                </f:facet>
                                <h:outputText value="#{VarModule.code}"/>
                            </p:column>
                            <p:column filterBy="#{VarModule.libelle}" sortBy="#{VarModule.libelle}">
                                <f:facet name="header">
                                    <h:outputText value="Libellé"/>
                                </f:facet>
                                <h:outputText value="#{VarModule.libelle}"/>
                            </p:column>
                        </p:dataTable>

                        <p:commandButton value="Valider" id="bdValiderModule" 
                                         actionListener="#{droitVisibiliteController.remplireObjetVisibilite()}"
                                         update=":F_Gen:module, :F_Gen:moduleCode, :fListEntity"
                                         oncomplete="PF('wListModule').hide()" icon="ui-icon-check" style="float: left;"/>
                        <p:commandButton value="Annuler" onclick="PF('wListModule').hide();" type="button" style="float: left;"/>


                    </p:dialog>
                </h:form>

                <h:form id="fListEntity">
                    <p:dialog header="Liste des entities" widgetVar="wListEntity"
                              resizable="false" id="idListEntity" modal="true">

                        <p:dataTable id="idListEntityTab" var="VarEntity" 
                                     value="#{droitVisibiliteController.listeAdminObjetVisibilite}"
                                     widgetVar="wListEntityTab" rows="10"
                                     paginator="true" emptyMessage="Liste vide" resizableColumns="true" 
                                     rowsPerPageTemplate="5, 10" style="width: 700px; font-family: serif;"
                                     paginatorTemplate="{FirstPageLink} {PreviousPageLink} 
                                     {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" 
                                     selection="#{droitVisibiliteController.objetVisibilite}" rowKey="#{VarEntity.id}">
                            <f:facet name="header">                                
                                Séléctioner un objets
                            </f:facet>
                            <p:column selectionMode="single" style="width:16px;text-align:center"/>
                            <p:column filterBy="#{VarEntity.entity}" sortBy="#{VarEntity.entity}" width="120">
                                <f:facet name="header">
                                    <h:outputText value="Entity"/>
                                </f:facet>
                                <h:outputText value="#{VarEntity.entity}"/>
                            </p:column>
                            <p:column filterBy="#{VarEntity.libelle}" sortBy="#{VarEntity.libelle}">
                                <f:facet name="header">
                                    <h:outputText value="Libellé"/>
                                </f:facet>
                                <h:outputText value="#{VarEntity.libelle}"/>
                            </p:column>
                        </p:dataTable>

                        <p:commandButton value="Valider" id="bdValiderModule" 
                                         update=":F_Gen:entity, :F_Gen:entityCode"
                                         oncomplete="PF('wListEntity').hide()" icon="ui-icon-check" style="float: left;"/>
                        <p:commandButton value="Annuler" onclick="PF('wListEntity').hide();" type="button" style="float: left;"/>
                    </p:dialog>
                </h:form>
            </ui:define>

        </ui:composition>

    </body>
</html>
