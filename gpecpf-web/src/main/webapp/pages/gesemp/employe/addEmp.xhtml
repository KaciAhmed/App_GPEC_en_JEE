<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/templates/templateGes.xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:a="http://elit.dz/ui">

    <ui:define name="Title">
        #{bundleGesemp.titre_nouveau_employe}
    </ui:define>

    <ui:define name="breadCrumb">
        <a:breadcrumb rendered="true">
            <a:menuitem value="#{bundleGesemp.titre_gestion_employe}" />
            <a:menuitem value="#{bundleGesemp.lien_liste_employe}" outcome="listEmp.xhtml" />
            <a:menuitem value="#{bundleCommun.btn_nouveau}" last="true" />
        </a:breadcrumb>
    </ui:define>

    <ui:define name="MyContent">
        <h:form id="form">
            <a:pagetitle value="#{bundleGesemp.titre_nouveau_employe}" />   
            <p:messages id="msgs" showDetail="true" globalOnly="false" showSummary="false" closable="true"/>
            <p:panel id="panel" styleClass="no-border">
                <p:focus context="panel"/>                
                <p:tabView  id="tabView">
                    <p:tab title="#{bundleGesemp.titre_information_generale}">    
                         <a:row>
                            <a:column span="6" >                                
                                <a:label value="#{bundleGesemp.lbl_matricule}" span="4" />
                                <a:column span="8" >
                                    <p:inputText id="matriculeEmp" value="#{addEmployeController.emp.matricule}" required="true" label="#{bundleGesemp.lbl_matricule}" size="40"/>
                                    <p:message for="matriculeEmp" />                                        
                                </a:column>                                
                            </a:column>
                            <a:column span="6" >   
                                <a:label value="#{bundleGesemp.lbl_typeContrat}" span="4" />
                               <a:column span="8" >
                                   <p:selectOneMenu id="contrat" required="true" requiredMessage="Contrat : erreur de validation. Vous devez indiquer une valeur" value="#{addEmployeController.emp.typeContrat}">
                                    <f:selectItem itemLabel="Select One" itemValue="#{null}" noSelectionOption="true" />
                                    <f:selectItem itemLabel="CDI – Contrat à durée indéterminée" itemValue="CDI – Contrat à durée indéterminée"/>
                                    <f:selectItem itemLabel="CDD – Contrat à durée déterminée" itemValue="CDD – Contrat à durée déterminée"/>
                                    <f:selectItem itemLabel="CTT – Contrat de travail temporaire ou Intérim" itemValue="CTT – Contrat de travail temporaire ou Intérim"/>
                                    <f:selectItem itemLabel="Contrat d’apprentissage" itemValue="Contrat d’apprentissage"/>
                                    <f:selectItem itemLabel="Contrat de professionnalisation" itemValue="Contrat de professionnalisation"/>
                                    <f:selectItem itemLabel="CAE – Contrat d’accompagnement dans l’emploi" itemValue="CAE – Contrat d’accompagnement dans l’emploi"/>
                                    <f:selectItem itemLabel="CIE – Contrat initiative emploi" itemValue="CIE – Contrat initiative emploi"/>
                                   </p:selectOneMenu>
                                   <p:message for="contrat" />
                               </a:column>     
                            </a:column> 
                        </a:row>
                         <a:row>
                           <a:column span="6" >                               
                               <a:label value="#{bundleGesemp.lbl_date_recrutement}" span="4" />
                                <a:column span="8" >
                                    <p:calendar  id="dateRec" value="#{addEmployeController.emp.date_recrutement}"  pattern="dd/MM/yyyy" required="true" label="#{bundleGesemp.lbl_date_recrutement}" 
                                                 locale="fr" navigator="true"> 
                                    </p:calendar>
                                    <p:message for="dateRec" />                                        
                                </a:column>                                
                            </a:column>
                            <a:column span="6" >                               
                               <a:label value="#{bundleGesemp.lbl_date_depart}" span="4" />
                                <a:column span="8" >
                                    <p:calendar  id="dateDep" value="#{addEmployeController.emp.date_depart}"  pattern="dd/MM/yyyy" mindate="#{addEmployeController.emp.date_recrutement}" label="#{bundleGesemp.lbl_date_depart}" 
                                                 locale="fr" navigator="true"> 
                                    </p:calendar>
                                    <p:message for="dateDep" />                                        
                                </a:column>                                
                            </a:column>
                        </a:row>
                        <a:row>
                            <a:column span="6" >
                                <a:label value="#{bundleGesemp.lbl_classement}" span="4" />
                                <a:column span="8" >
                                    <p:inputText id="classement" value="#{addEmployeController.emp.classement}" required="true" label="#{bundleGesemp.lbl_classement}" />
                                    <p:message for="classement" />                                        
                                </a:column>                                
                            </a:column> 
                            <a:column span="6" >
                                <a:label value="#{bundleGesemp.lbl_userName}" span="4" />
                                <a:column span="8" >
                                    <h:outputText id="out" />
                                    <p:inputText id="userName" value="#{addEmployeController.emp.userName}"  label="#{bundleGesemp.lbl_userName}" />
                                    <p:message for="userName" />                                        
                                </a:column>                               
                            </a:column>
                        </a:row>
                        <a:row style="margin-bottom:2%;margin-top: 2%">
                            <a:column span="6" >
                                <h:outputText value="#{bundleGesemp.lbl_information_personnel}" style="color: rgb(28,175,154);font-weight: bold;font-size: medium;font-style: italic" />
                              </a:column>
                        </a:row>
                        <a:row>
                            <a:column span="6" >
                                <a:label value="#{bundleGesemp.lbl_nom}" span="4" />
                                <a:column span="8" >
                                    <p:inputText id="nom" value="#{addEmployeController.emp.nom}" required="true" label="#{bundleGesemp.lbl_nom}" />
                                    <p:message for="nom" />                                        
                                </a:column>                                
                            </a:column>  
                            <a:column span="6" >                                
                                <a:label value="#{bundleGesemp.lbl_prenom}" span="4" />
                                <a:column span="8" >
                                    <p:inputText id="prenom" value="#{addEmployeController.emp.prenom}" required="true" label="#{bundleGesemp.lbl_prenom}" size="40"/>
                                    <p:message for="prenom" />                                        
                                </a:column>                                
                            </a:column>
                        </a:row>
                        <a:row>
                            <a:column span="6" >   
                                <a:label value="#{bundleGesemp.lbl_sexe}" span="4" />
                               <a:column span="8" >
                                   <p:selectOneMenu id="sexe" required="true" value="#{addEmployeController.emp.sexe}" requiredMessage="Sexe : erreur de validation. Vous devez indiquer une valeur">
                                    <f:selectItem itemLabel="Select One" itemValue="#{null}" noSelectionOption="true" />
                                    <f:selectItem itemLabel="Homme" itemValue="Homme"/>
                                    <f:selectItem itemLabel="Femme" itemValue="Femme"/>
                                   </p:selectOneMenu>
                                   <p:message for="sexe" />
                               </a:column>     
                            </a:column> 
                           <a:column span="6" >                               
                               <a:label value="#{bundleGesemp.lbl_date_naissance}" span="4" />
                                <a:column span="8" >
                                    <p:calendar  id="dateNaiss" value="#{addEmployeController.emp.dtNaissance}"  pattern="dd/MM/yyyy"  required="true" label="#{bundleGesemp.lbl_date_naissance}" 
                                                 locale="fr" navigator="true"> 
                                    </p:calendar>
                                    <p:message for="dateNaiss" />                                        
                                </a:column>                                
                            </a:column>
                         </a:row>
                         <a:row> 
                            <a:column span="6" >                                
                                <a:label value="#{bundleGesemp.lbl_adresse}" span="4" />
                                <a:column span="8" >
                                    <p:inputTextarea cols="120" id="Adresse" value="#{addEmployeController.emp.adresse}" label="#{bundleGesemp.lbl_adresse}" required="true"/>
                                </a:column>  
                            </a:column>
                        </a:row>
                         <a:row>
                            <a:column span="6" >   
                            <a:label value="#{bundleGesemp.lbl_wilaya}" span="4" />
                              <a:column span="8" >
                                    <p:selectOneMenu id="wilaya" required="true" value="#{addEmployeController.idWil}" requiredMessage="Wilaya: erreur de validation. Vous devez indiquer une valeur">
                                        <f:selectItem itemLabel="Select One" itemValue="#{null}" noSelectionOption="true"  />
                                        <f:selectItems value="#{addEmployeController.listWilayas}" var="wilaya" itemLabel="#{wilaya.nom}" itemValue="#{wilaya.id}"/>
                                        <p:ajax listener="#{addEmployeController.CommuneParWilaya()}"  update="commune2"/>
                                    </p:selectOneMenu>
                                  <p:message for="wilaya" />
                               </a:column>
                            </a:column> 
                            <a:column span="6" >   
                                <a:label value="#{bundleGesemp.lbl_commune}" span="4" />
                               <a:column span="8" >
                                   <p:selectOneMenu id="commune2" required="true" value="#{addEmployeController.idComune}" requiredMessage="Commune: erreur de validation. Vous devez indiquer une valeur">
                                    <f:selectItem itemLabel="Select One" itemValue="#{null}" noSelectionOption="true"  />
                                    <f:selectItems value="#{addEmployeController.listCommunes}" var="commune" itemLabel="#{commune.nom}" itemValue="#{commune.id}"/>
                                    <p:ajax listener="#{addEmployeController.obtenirCommune()}"/>
                                   </p:selectOneMenu>
                                   <p:message for="commune2" />
                               </a:column>     
                            </a:column> 
                        </a:row>
                        <a:row style="margin:2%;font-style: italic">
                            <a:column span="6" >
                                <h:outputText value="#{bundleAdmin.lbl_contact}" style="color: rgb(28,175,154);font-weight: bold;font-size: medium" />
                              </a:column>
                        </a:row>
                         <a:row>
                            <a:column span="6" >                                
                                 <a:label value="#{bundleGesemp.lbl_email}" span="4" />
                                <a:column span="8" >
                                    <p:inputText  id="email" value="#{addEmployeController.emp.email}" label="#{bundleGesemp.lbl_email}"  validatorMessage="Invalid email format" size="40" required="true"> 
                                        <f:validateRegex pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
                                    </p:inputText>
                                    <p:message for="email" />
                                </a:column>                                
                            </a:column>
                            <a:column span="6" >                                
                                <a:label value="#{bundleGesemp.lbl_telephone}" span="4" />
                                <a:column span="8" >
                                    <p:inputText id="tel" value="#{addEmployeController.emp.tel}" required="true" validatorMessage="Numéro de téléphone invalide" label="#{bundleGesemp.lbl_telephone}">
                                         <f:validateRegex pattern="^|([0-9]{10}$)" />
                                    </p:inputText>
                                    <p:message for="tel" />                                        
                                </a:column>                                
                            </a:column> 
                        </a:row>
                    </p:tab>
                    <p:tab id="tabformations" title="#{bundleGesemp.lbl_formation_employe}">
                        <a:row>

                            <a:panel header="#{bundleGesemp.lien_liste_formation}"  >
                                <f:facet name="header" >
                                    <p:commandButton  title="#{bundleGesemp.lien_liste_formation}" value="#{bundleCommun.btn_ajouter}"   icon="fa fa-plus"  immediate="true" oncomplete="PF('dialogFormation').show();"/> 
                                </f:facet>
                                <p:dataTable id="tableformations" value="#{addEmployeController.emp.listFormation}" var="formation" emptyMessage="#{bundleCommun.msg_list_vide}" reflow="true" paginator="true" paginatorAlwaysVisible="false" paginatorPosition="bottom" >
                                    <p:column headerText="#{bundleGesemp.lbl_code}" >
                                        <h:outputText value="#{formation.code}"/>
                                    </p:column>
                                    <p:column headerText="#{bundleGesemp.lbl_description}">
                                        <h:outputText value="#{formation.description}"/>
                                    </p:column>
                                    <p:column headerText="#{bundleCommun.lbl_actions}" width="60">
                                        <p:commandButton icon="fa fa-times" styleClass="BlackButton" actionListener="#{addEmployeController.removeFormationForEmploye(formation)}" update=":formDialogs:panelformations :form:tabView:tableformations" process="@this"/>
                                    </p:column>

                                </p:dataTable>
                            </a:panel>
                        </a:row>
                    </p:tab>
                     <p:tab id="tabPostes" title="#{bundleGesemp.lbl_poste_employe}">
                         <a:row>
                            <a:panel header=" #{bundleGesemp.lbl_poste_employe}" iconheader="fa fa-list-ul">
                                    <f:facet name="header">  
                                        <p:commandButton title="#{bundleGesemp.titre_ajouter_poste_employe}"  icon="fa fa-pencil-square-o" value="#{bundleCommun.btn_ajouter}" immediate="true" onclick="PF('dialogPoste').show();"/> 
                                    </f:facet>
                                <p:dataTable  id="tablePoste" value="#{addEmployeController.posteEmp}" var="poste" rowKey="#{poste.id}" rows="4" emptyMessage="#{bundleCommun.msg_list_vide}" reflow="true" paginator="true" paginatorPosition="bottom" paginatorAlwaysVisible="false" >
                                        <p:column headerText="#{bundleCommun.lbl_code}" >
                                            <h:outputText value="#{poste.code}"/>
                                        </p:column>
                                        <p:column headerText="#{bundleGesemp.lbl_denomination}">
                                            <h:outputText value="#{poste.denomination}"/>
                                        </p:column>
                                 </p:dataTable>
                            </a:panel>
                        </a:row>
                    </p:tab>
                   
                </p:tabView>                
            </p:panel> 
            <a:row >
                <p:commandButton value="#{bundleCommun.btn_valider}" action="#{addEmployeController.create()}" icon="fa  fa-check-square-o" update="panel msgs"/>
                <p:commandButton value="#{bundleCommun.btn_retour}" immediate="true" icon="fa fa-reply" action="listEmp" styleClass="GrayButton" ajax="false" />
                <p:commandButton value="#{bundleCommun.btn_reset}" immediate="true" icon="fa fa-times " styleClass="RedButton" action="addEmp" update="panel :formDialogs:panelformations :formDialogs:panelPoste" process="@this" >
                <p:resetInput target="panel" />
                </p:commandButton>
            </a:row>
        </h:form> 
    </ui:define>
    <ui:define name="MyDialog">
        <h:form id="formDialogs">
            <p:dialog id="dialogFormationId" widgetVar="dialogFormation" header="#{bundleGesemp.lien_liste_formation}"  width="60%" position="center" modal="true"  responsive="true" >
                <h:panelGroup id="panelformations">
                    <p:dataTable value="#{addEmployeController.listFormations}" rows="10" var="formation" selection="#{addEmployeController.listFormationsSelected}" rowKey="#{formation.id}" emptyMessage="#{bundleCommun.msg_list_vide}" paginator="true" paginatorAlwaysVisible="false" paginatorPosition="bottom">
                        <p:column selectionMode="multiple" width="10"/>
                        <p:column headerText="#{bundleGesemp.lbl_description}" filterBy="#{formation.description}" filterMatchMode="contains" >
                            <h:outputText value="#{formation.description}"/>
                        </p:column>
                        <f:facet name="footer" > 
                            <p:commandButton title="#{bundleCommun.btn_ajouter}"  styleClass="GrayButton"  value="#{bundleCommun.btn_ajouter}" process=":formDialogs:panelformations" actionListener="#{addEmployeController.addFormationForEmploye()}" 
                                             update=":formDialogs:panelformations :form:tabView:tableformations"       oncomplete="PF('dialogFormation').hide();"  />
                        </f:facet>
                    </p:dataTable>
                </h:panelGroup>   
            </p:dialog>
            <p:dialog id="dialogPostId" widgetVar="dialogPoste" header="#{bundleGesemp.titre_ajouter_poste_employe}" modal="true"  width="60%" responsive="true" position="center">
                   <h:panelGroup id="panelPoste">   
                    <a:row>
                        <p:dataTable id="tablePosteDialog" value="#{addEmployeController.listPostes}" var="poste" rowKey="#{poste.id}" selection="#{addEmployeController.posteSelected}" reflow="true" rows="10"  emptyMessage="#{bundleCommun.msg_list_vide}" paginatorPosition="bottom" paginator="true" paginatorAlwaysVisible="false"  widgetVar="myWidgetVar">
                            <p:column selectionMode="single" width="10"/>
                            <p:column headerText="#{bundleCommun.lbl_code}" filterBy="#{poste.code}" filterMatchMode="contains" >
                                <h:outputText value="#{poste.code}"/>
                            </p:column>
                            <p:column headerText="#{bundleGesemp.lbl_denomination}" filterBy="#{poste.denomination}" filterMatchMode="contains">
                                <h:outputText value="#{poste.denomination}"/>
                            </p:column>
                            <f:facet name="footer" >
                                <div class="form-actions">
                                    <a:row nomargin="true">
                                        <a:column span="9">
                                            <a:row nomargin="true">
                                                <a:column  span="9" id="pgbtndlg">
                                                    <p:commandButton title="#{bundleCommun.btn_valider}" icon="fa fa-check-square-o" value="#{bundleCommun.btn_valider}" process=":formDialogs:tablePosteDialog" actionListener="#{addEmployeController.addPosteForEmploye()}" 
                                                              update=":formDialogs:tablePosteDialog :form:tabView:tablePoste"        oncomplete="PF('dialogPoste').hide();"/> 
                                                    <p:commandButton value="#{bundleCommun.btn_retour}"  icon="fa fa-reply" styleClass="GrayButton" onclick="PF('dialogPoste').hide()" />
                                                </a:column>
                                            </a:row>   
                                        </a:column>
                                    </a:row>
                                </div>
                            </f:facet>
                        </p:dataTable>
                    </a:row>
                </h:panelGroup> 
            </p:dialog>
         </h:form> 
    </ui:define>
</ui:composition>
